-- Create a function to convert Julian date format to Gregorian date format
CREATE OR REPLACE FUNCTION EMP.UDFS.UDFS_JUL_GRE_CONV("JDATE" VARCHAR)
RETURNS DATE
LANGUAGE SQL
AS
$$
    SELECT TO_DATE(DATEADD(DAYS, CAST(SUBSTR(JDATE,LENGTH(JDATE)-2,3) AS NUMBER)-1, DATEADD(YEAR, CAST(SUBSTR(JDATE, 1, LENGTH(JDATE) -3) AS NUMBER), '1900-01-01'))) AS GREG_DATE
$$;

SELECT UDFS.UDFS_JUL_GRE_CONV('111152'), UDFS.UDFS_JUL_GRE_CONV('098032'), UDFS.UDFS_JUL_GRE_CONV('123232');



-- if we receive jul date as 5 digit number like 98032, then pad one 0 to left side i.e., LPAD(JDATE,6,0)

-- Create  a function to convert Julian date format to Gregorian date format
CREATE OR REPLACE FUNCTION EMP.UDFS.UDFS_JUL_GRE_CONV("JDATE" VARCHAR)
RETURNS DATE
LANGUAGE SQL
AS
$$
    WITH JUL_DATE AS (SELECT LPAD(JDATE, 6, 0) AS JD)

    SELECT TO_DATE(DATEADD(DAYS, CAST(SUBSTR(JD,LENGTH(JD)-2,3) AS NUMBER)-1, DATEADD(YEAR, CAST(SUBSTR(JD, 1, LENGTH(JD) -3) AS NUMBER), '1900-01-01'))) AS GREG_DATE 
    FROM JUL_DATE
$$;

SELECT UDFS.UDFS_JUL_GRE_CONV('111152'), UDFS.UDFS_JUL_GRE_CONV('098032'), UDFS.UDFS_JUL_GRE_CONV('98032'), UDFS.UDFS_JUL_GRE_CONV('98033');