CREATE OR REPLACE PROCEDURE TEST_EMP.PROCS.SP_TO_LOAD_SAMPLE_DATA("SRCDB" VARCHAR, "SRCSCH" VARCHAR, "SRCTBL" VARCHAR, "TGTDB" VARCHAR, "TGTSCH" VARCHAR, "TGTTBL" VARCHAR, "DATA_VOLUME" INTEGER)
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER

AS

DECLARE

-- DATA_VOLUME IS THE % OF RECORDS TO BE COPIED
    CRT_TBL_QRY VARCHAR;
    INSERT_QRY VARCHAR;

BEGIN
    CRT_TBL_QRY := 'CREATE TABLE IF NOT EXISTS ' || :TGTDB || '.' || :TGTSCH || '.' || :TGTTBL || ' AS SELECT * FROM ' || :SRCDB || '.' || :SRCSCH || '.' || :SRCTBL || ' WHERE 1 = 2';
    EXECUTE IMMEDIATE :CRT_TBL_QRY;

    INSERT_QRY := 'INSERT INTO ' || :TGTDB || '.' || :TGTSCH || '.' || :TGTTBL || ' SELECT * FROM ' || :SRCDB || '.' || :SRCSCH || '.' || :SRCTBL || ' SAMPLE('||:DATA_VOLUME||')';
    EXECUTE IMMEDIATE :INSERT_QRY;

RETURN 'Insertion of Sample Data has been COMPLETED';
END;


    
CALL TEST_EMP.PROCS.SP_TO_LOAD_SAMPLE_DATA('SNOWFLAKE_SAMPLE_DATA', 'TPCH_SF1', 'CUSTOMER', 'TEST_EMP', 'HRDATA', 'CUSTOMER_COPY', 10);